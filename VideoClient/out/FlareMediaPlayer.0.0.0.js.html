<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: FlareMediaPlayer.0.0.0.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: FlareMediaPlayer.0.0.0.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Wrapper for Flare Media Player Plugin
 */
(function(){

    var root = this;

/**
 * @namespace Flare
 */
var Flare = Flare || {
    /**
     * The Version Number
     * @memberOf Flare
     * @constant
     * @type {string}
     */
    VERSION: '0.0.0',
    
    /**
     * An array of video player instances. This way we can add multiple video players without having 
     * to worry about it later.
     * @memberOf Flare
     * @constant
     * @type {array}
     */
    PLAYERS: []
    
};


/**
 * Flare Default Constants
 * @author Brian Parra
 * @memberOf Flare
 * @type {object}
 * @constant
 */
Flare.CONSTANTS = {
    //Put Constant values here
    VIDEO_SIZE:{
        ORIGINAL: 0,
        FIXED: 1,
        RESPONSIVE: 2
    },
    
    VIDEO_SCALE_MODE : {
        MAINTAIN_ASPECT: 0,
        FILL: 1
    },
    
    FLARE_MESSAGE_HEADER_LENGTH: 5,
    



};

/**
 * Class for handeling initialization of video metadata
 * @author Brian Parra
 * @memberOf Flare
 * @class Flare.InitializeVideoTask
 * @constructor
 * @return {Flare.InitializeVideoTask} returns a Flare InitializeVideoTask
 */

Flare.InitializeVideoTask = function () {


    /**
     * @property {object} data the raw incoming data
     */
    this.data;

    /**
     * @property {object} dataView the dataview created to navigate data
     */
    this.dataView;

    /**
     * @property {number} flareOpCode this is the flare opcode in the message
     */
    this.flareOpCode;

    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer;


    return this;

};

/**
 * Sets the binary data recieved from message
 * @memberof Flare.InitializeVideoTask.prototype
 * @function setData
 * @param {object} data binary array of data
 */
Flare.InitializeVideoTask.prototype.setData = function (data) {

    this.data = data;
    this.dataView = new DataView(this.data);
    this.flareOpCode = Flare.OpCode.OPEN_VIDEO;
    this.videoIsAvailable = false;

    this.width = 0;
    this.height = 0;
    this.fps = 0;
    this.duration = 0;

};


/**
 * Sets media player reference
 * @memberof Flare.InitializeVideoTask.prototype
 * @function setMediaPlayer
 * @param {Flare.MediaPlayer} mediaPlayer reference to the media player
 */
Flare.InitializeVideoTask.prototype.setMediaPlayer = function (mediaPlayer) {

    this.mediaPlayer = mediaPlayer;

};

/**
 * Processess the message recieved
 * @memberof Flare.InitializeVideoTask.prototype
 * @function process
 */
Flare.InitializeVideoTask.prototype.process = function () {

    var dataLength = this.dataView.getInt32(1);
    var videoIsAvailable = this.dataView.getInt8(5);
    console.log("the video you requested is " + this.mediaPlayer.options.videoID);
    //console.log(videoIsAvailable);

    if (videoIsAvailable === 1) {
        this.videoIsAvailable = true;
        this.width = this.dataView.getInt32(6);
        this.height = this.dataView.getInt32(10);
        this.fps = this.dataView.getFloat64(14);
        this.duration = this.dataView.getFloat64(22);
        this.frameCount = this.dataView.getInt32(30);
        console.log(this.width + " width");
        console.log(this.height + " height ");
        console.log(this.fps + " fps ");
        console.log(this.duration + " duration ");
        console.log(this.frameCount + "frame Count");


        this.mediaPlayer.buffer.initFrameBuffer(this.frameCount, this.fps, this.duration); //Swap out for dynamic buffer and frame rate later
        this.mediaPlayer.videoPlayer.setDuration(this.duration);
        this.mediaPlayer.videoPlayer.setFps(this.fps);

        console.log("video is available!");
    } else {
        console.log("video is not available!");
    }




};

Flare.InitializeVideoTask.prototype.constructor = Flare.InitializeVideoTask;
/**
 * Class for handeling incoming audio data
 * @author Brian Parra 
 * @memberOf Flare
 * @class Flare.ProcessAudioTask
 * @constructor
 * @return {Flare.ProcessAudioTask} returns a Flare ProcessAudioTask
 */
Flare.ProcessAudioTask = function () {


    /**
     * @property {object} data the raw incoming data
     */
    this.data;

    /**
     * @property {object} dataView the dataview created to navigate data
     */
    this.dataView;

    /**
     * @property {number} flareOpCode this is the flare opcode in the message
     */
    this.flareOpCode;

    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer;



    return this;




};


/**
 * Sets the binary data recieved from message
 * @memberof Flare.ProcessAudioTask.prototype
 * @function setData
 * @param {object} data binary array of data
 */
Flare.ProcessAudioTask.prototype.setData = function (data) {

    this.data = data;
    this.dataView = new DataView(this.data);
    this.flareOpCode = Flare.OpCode.FRAME;
    this.videoIsAvailable = false;

};

/**
 * Sets media player reference
 * @memberof Flare.ProcessAudioTask.prototype
 * @function setMediaPlayer
 * @param {Flare.MediaPlayer} mediaPlayer reference to the media player
 */
Flare.ProcessAudioTask.prototype.setMediaPlayer = function (mediaPlayer) {

    this.mediaPlayer = mediaPlayer

};

/**
 * Processess the message recieved
 * @memberof Flare.ProcessAudioTask.prototype
 * @function process
 */
Flare.ProcessAudioTask.prototype.process = function () {

    var dataLength = this.dataView.getInt32(0);


    this.mediaPlayer.buffer.setAudioData(this.data.slice(5));

};

Flare.ProcessAudioTask.prototype.constructor = Flare.ProcessAudioTask;

/**
 * Class for handeling incoming Frame Data
 * @author Brian Parra
 * @memberOf Flare
 * @class Flare.ProcessFrameTask
 * @constructor
 * @return {Flare.ProcessFrameTask} returns a Flare ProcessFrameTask
 */

Flare.ProcessFrameTask = function () {


    /**
     * @property {object} data the raw incoming data
     */
    this.data;

    /**
     * @property {object} dataView the dataview created to navigate data
     */
    this.dataView;

    /**
     * @property {number} flareOpCode this is the flare opcode in the message
     */
    this.flareOpCode;

    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer;

    return this;




};

/**
 * Sets the binary data recieved from message
 * @memberof Flare.ProcessFrameTask.prototype
 * @function setData
 * @param {object} data binary array of data
 */
Flare.ProcessFrameTask.prototype.setData = function (data) {

    this.data = data;
    this.dataView = new DataView(this.data);
    this.flareOpCode = Flare.OpCode.FRAME;
    this.videoIsAvailable = false;

};

/**
 * Sets media player reference
 * @memberof Flare.ProcessFrameTask.prototype
 * @function setMediaPlayer
 * @param {Flare.MediaPlayer} mediaPlayer reference to the media player
 */
Flare.ProcessFrameTask.prototype.setMediaPlayer = function (mediaPlayer) {

    this.mediaPlayer = mediaPlayer

};

/**
 * Processess the message recieved
 * @memberof Flare.ProcessFrameTask.prototype
 * @function process
 */
Flare.ProcessFrameTask.prototype.process = function () {

    var dataLength = this.dataView.getInt32(0);
    var index = this.dataView.getUint32(5);


    //This way is probably super slow!!!!
    var img = new Image;
    var blob = new Blob([this.data.slice(9)], {type: 'image/jpg'});
    var urlCreator = window.URL || window.webkitURL;
    var imageUrl = urlCreator.createObjectURL(blob);
    img.src = imageUrl;
    //console.log("frame " +index + "loaded");




    this.mediaPlayer.buffer.setFrameAt(index, img);







};

Flare.ProcessFrameTask.prototype.constructor = Flare.ProcessFrameTask;
/**
 * class for handling audio engine
 * @author Fredrik Sigvartsen
 * @memberOf Flare
 * @class Flare.AudioEngine
 * @constructor
 * @param {Flare.MediaPlayer} mediaPlayer a reference to the mediaPlayer
 * @return {Flare.AudioEngine} returns a Flare AudioEngine
 */

Flare.AudioEngine = function (mediaPlayer) {

    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer = mediaPlayer;

    /**
     * @property {boolean} mute tells if audio playback is muted
     */
    this.mute;

    /**
     * @property {buffer} source this is the buffer source to play from
     */
    this.source = null;

    /**
     * @property {number} offset the offset in ms to start playing from 
     */
    this.offset;


    /**
     * @property {node} webAudio node for gain
     */
    this.gainNode;



    return this;
};

Flare.AudioEngine.prototype = {
    /**
     * Initializes the audio engine
     * @memberof Flare.AudioEngine.prototype
     * @function boot
     */
    boot: function () {
        //this.mute = document.querySelector('.muteButton');

        this.gainNode = this.mediaPlayer.audioCtx.createGain();
        this.playing = false;

    },
    /**
     * Creates a new buffer source. This needs to be updated because right now its decoding every time before playing
     * @memberof Flare.AudioEngine.prototype
     * @function createNewBufferSource
     */
    createNewBufferSource: function () {
        //this.source.buffer = this.mediaPlayer.buffer.getAudioSource();//Buffer.read Waiting for Jens to finish is buffering

        this.source = this.mediaPlayer.audioCtx.createBufferSource();
        this.mediaPlayer.audioCtx.decodeAudioData(this.mediaPlayer.buffer.getAudioSource(), function (decodedBuffer) {
            this.source.buffer = decodedBuffer;
            console.log("done loading buffer");
            this.source.connect(this.gainNode);
            this.gainNode.connect(this.mediaPlayer.audioCtx.destination);
            console.log(this.offset);
            this.source.start(0, this.offset);
        }.bind(this));



    },
    /**
     * Starts the playback at the desired offset in ms
     * @memberof Flare.AudioEngine.prototype
     * @function playSound
     * @param {number} time offset in ms
     */
    playSound: function (time) {

        if (this.playing)
            return;

        this.offset = time / 1000;
        this.createNewBufferSource();


        this.playing = true;

    },
    /**
     * Stops playback
     * 
     * @memberof Flare.AudioEngine.prototype
     * @function stopSound
     */
    stopSound: function () {

        //if (!this.source.stop)
        //  this.source.stop = this.source.noteOff;

        this.source.stop();
        this.playing = false;

    },
    /**
     * toggles playback time
     * 
     * @memberof Flare.AudioEngine.prototype
     * @function toggle
     * @param {number} time offset to toggle at
     */
    toggle: function (time) {

        this.playing ? this.stop(time) : this.play(time);
        this.playing = !this.playing;

    },
    /**
     * mutes the audio
     * 
     * @memberof Flare.AudioEngine.prototype
     * @function muteAudio
     */
    muteAudio: function () {

        if (this.mute.id != "activated") {
            this.gainNode.gainvalue = 0; //Muting
            this.mute.id = "activated";
            this.mute.innerHTML = "Unmute"; //Will probably change to a different button in the mediaplayer
        } else {
            this.gainNode.gain.value = 1;
            this.mute.id = "deactivated";
            this.mute.innerHTML = "Mute";
        }

    },
    /**
     * Canges the audio volume
     * 
     * @memberof Flare.AudioEngine.prototype
     * @function changeVolume
     * @param {rangeElement} rangeElement range of volume slider
     */
    changeVolume: function (rangeElement) {

        var volume = element.value;
        var portion = parseInt(volume) / parseInt(element.max);

        this.gainNode.gain.value = portion * portion;

    }
};

Flare.AudioEngine.prototype.constructor = Flare.AudioEngine;
/**
 * class for handling buffering
 * @author Jens Omfjord
 * @memberOf Flare
 * @class Flare.Buffer
 * @constructor
 * @param {MediaPlayer} mediaPlayer a reference to the mediaPlayer
 */
Flare.Buffer= function (mediaPlayer) {


    /**
    * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
    */

    this.mediaPlayer = mediaPlayer;
    
    /*
     * @property {number} channels number of audio channels
     */
    this.channels = 2 //Stereo for now

    
    this.frame_count = this.mediaPlayer.audioCtx.sampleRate = 2.0;

    this.audio_buffer = this.mediaPlayer.audioCtx.createBuffer(this.channels, this.frame_count, this.mediaPlayer.audioCtx.sampleRate);

    this.frameBuffer;
    
    this.frameCount;

    this.frameRate;
    
    this.duration;
    
    this.fps;
    
    this.framesLoaded = 0;
    this.isLoaded = false;
    
    this.audioData = null;
    
    return this;
    
    
    
    
};

Flare.Buffer.prototype = {
	write: function () {
		for(var channel = 0; channel &lt; channels; channel++){
			this.current_buffer = this.audio_buffer.getChannelData(channel);
			for(var i = 0; i &lt; this.frame_count; i++){
				this.current_buffer[i] = Math.random() * 2 - 1;
			}
		}

		var source = this.mediaPlayer.audioSource;

		source.buffer = this.audio_buffer;

		source.connect(this.mediaPlayer.audioCtx.destination);
	},

	read: function () {
		this.return_array = this.audio_buffer.slice();	//throw exception if reading from empty buffer
		return this.return_array;
	},
        
        initFrameBuffer: function(_frameCount, _frameRate, _duration){
            
            this.frameBuffer = new Array(_frameCount);
            this.frameCount = _frameCount;
            this.frameRate = _frameRate;
            this.duration = _duration;
            
        },
        
        getFrameAt : function(index){
            
            return this.frameBuffer[index];
            
        },
        
        setFrameAt : function (index, frame){
            
            this.frameBuffer[index] = frame;
            this.framesLoaded++;
            
            this.mediaPlayer.videoPlayer.updateLoadProgress(this.framesLoaded / this.frameCount);
            
            if(this.frameCount === this.framesLoaded){
                this.isLoaded = true;
                this.mediaPlayer.videoPlayer.toggleLockingButtons(); // locking all buttons in mediaplayer
                this.mediaPlayer.videoPlayer.removeLoadingBar();
                console.log("buffer doneLoading");
            }
        },
        
        setDuration: function(duration){
            this.duration = duration;
        },
        
        setAudioData : function(data){
            this.audioData = data;
            //this.mediaPlayer.audioEngine.createNewBufferSource();
            //console.log(this.audioData);
        },
        
        getAudioSource : function(){
            return this.audioData;
        },
        
        getFrameCount: function(){
            return this.frameCount;
        },
        
        getDuration: function(){
            return this.duration;
        },
        
        getFps : function(){
            return this.fps();
        },
        
        setFps : function(fps){
            this.fps = fps;
        }

};

Flare.Buffer.prototype.constructor = Flare.Buffer;
/**
 * class for handling the canvas element
 * @author Fredrik Sigvartsen and Brian Parra
 * @memberOf Flare
 * @class Flare.Canvas
 * @constructor
 * @param {Flare.MediaPlayer} mediaPlayer a reference to the mediaPlayer
 * @return {Flare.Canvas} returns a Flare Canvas
 */

Flare.Canvas = function (videoPlayer) {

    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the video player.
     */
    this.videoPlayer = videoPlayer;

    /**
     * @property {element} canvas the canvas element
     */
    this.canvas = document.createElement('canvas');

    /**
     * @param {object} ctx the 2d canvas context
     */
    this.ctx = this.canvas.getContext("2d");

    /**
     * @param {string} id the canvas id
     */
    this.canvas.id = "testId";//mediaPlayer.id;

    /**
     * @param {number} width the canvas width
     */
    this.canvas.width = 960;

    /**
     * @param {number} height the canvas height
     */
    this.canvas.height = 540;


    this.canvas.style.display = 'block';
    this.canvas.style.backgroundColor = 'black';

    return this;



};

Flare.Canvas.prototype = {
    /**
     * Renders the passed frame to canvas
     * @memberof Flare.Canvas.prototype
     * @function createNewBufferSource
     * @param {object} frame image data to draw
     */
    render: function (frame) {

        this.ctx.drawImage(frame, 0, 0);
        //RENDER LOGIC GOES HERE
        //THE ARGUMENT IS THE FULLY RENDERED FRAME, JUST NEED TO PAINT TO THE CANVAS  

    },
    /**
     * Returns the canvas element
     * @memberof Flare.Canvas.prototype
     * @function createNewBufferSource
     * @return {object} the canvas
     */
    getCanvas: function () {

        return this.canvas;

    }
};

Flare.Canvas.prototype.constructor = Flare.Canvas;
/**
 * This is the main Media Player class one single media player can be either an audio only, or video and audio player
 * @author Jens Omfjord and Brian Parra
 * @memberOf Flare
 * @class Flare.MediaPlayer
 * @constructor
 * @param {object} userOptions the passed in user options
 * @return {Flare.MediaPlayer} returns a Flare MediaPlayer
 */
Flare.MediaPlayer = function (userOptions) {

    /**
     * @property {number} id - video player id, for handling multiple MediaPlayer Objects
     */
    this.id = Flare.PLAYERS.push(this) - 1;

    /**
     * @property {object} options these are the default options which the user can override
     */
    this.options = {
        port: 6661,
        uri: 'localhost',
        videoID: '',
        container: '',
        //videoPath: '',
        videoSize: Flare.CONSTANTS.VIDEO_SIZE.ORIGINAL,
        videoScale: '',
        width: 960,
        height: 540

    }; //Default options


    this.parseOptions(userOptions);



    /**
     * @property {object} _networkManager internal reference to network manager
     */
    this._networkManager = null; //Not sure if public or private yet

    /**
     * @property {boolean} isBooted is the media player fully booted
     */
    this.isBooted = null;

    /**
     * @property {object} oscillator reference to an oscillator
     */
    this.oscillator = null;

    /**
     * @property {object} videoPlayer reference to the video player object
     */
    this.videoPlayer = null;

    /**
     * @property {object} audioEngine reference to an audio engine
     */
    this.audioEngine = null;

    /**
     * @property {object} buffer reference to the buffer
     */
    this.buffer = null;

    /**
     * @property {object} audioCtx reference to audio context
     */
    this.audioCtx = null;

    /**
     * @property {boolean} isPlaying is the media player currently in play mode
     */
    this.isPlaying = false;

    /**
     * @property {number} timeStarted time at which playback started
     */
    this.timeStarted = 0;

    /**
     * @property {number} totalTimePaused elapsed time while not in play mode after starting
     */
    this.totalTimePaused = 0;

    /**
     * @property {number} numPressedPlay a number for keeping track of toggling the play button
     */
    this.numPressedPlay = 0;

    /**
     * @property {number} deltaTime the difference in time since lased updated
     */
    this.deltaTime;

    /**
     * @property {number} timePaused time since paused
     */
    this.timePaused = 0;

    /**
     * @property {boolean} donePlaying has playback reached end of timeline
     */
    this.donePlaying = false;


    /**
     * @property {Flare.Device} Reference to global device object
     */
    this.device = Flare.Device;

    //You have to wait for the device to be ready
    this.device.whenReady(this.boot, this);

    console.log('Flare Media Player BETA  www.flaremediaplayer.com');

    return this;
};

Flare.MediaPlayer.prototype = {
    /**
     * Parses the user options
     * @memberof Flare.MediaPlayer.prototype
     * @function parseOptions
     * @param {object} userOptions These are the options passed in when initializing a flare media player
     */
    parseOptions: function (userOptions) {
        //REMEMBER TO SANITIZE USER INPUT
        console.log(userOptions);
        if (typeof userOptions.videoID != 'undefined') {

            this.options.videoID = userOptions.videoID;

        } else {
            console.log("location is not set");
        }

        if (typeof userOptions.uri != 'undefined') {

            this.options.uri = userOptions.uri;

        }

        if (typeof userOptions.container != 'undefined') {

            this.options.container = userOptions.container;

        }

    },
    /**
     * Boots up the entire media player
     * @memberof Flare.MediaPlayer.prototype
     * @function boot
     */
    boot: function () {

        if (this.isBooted) {
            return;
        }


        var AudioContext = window.AudioContext || window.webkitAudioContext;
        this.audioCtx = new AudioContext();
        //Initialize System
        this.oscillator = new Flare.Oscillator(this);
        this.clock = new Flare.Clock(this);
        this.buffer = new Flare.Buffer(this);
        this.audioEngine = new Flare.AudioEngine(this);
        this._networkManager = new Flare.NetworkManager(this);
        //this._networkManager.requestVideo(this.options.videoPath);



        this.videoPlayer = new Flare.VideoPlayer(this);

        //this.canvas = new Flare.Canvas(this);
        //this.canvas.addToDOM();

        this.videoPlayer.boot();
        this.audioEngine.boot();
        //Okay now start the oscillator
        this.clock.boot();
        this.oscillator.run();




    },
    /**
     * This is the core video logic loop
     * @memberof Flare.MediaPlayer.prototype
     * @param {time} time of update
     */
    update: function (time) {
        this.clock.update(time);
        //Finished with update, render the frame:
        //TESTING ONLY

        /*
         if(this.numPressedPlay === 0){
         this.setStartTime(Date.now());
         }
         */

        //this.canvas.render(this.frames[this.testCounter%152]);
        if (this.isPlaying) {


            this.deltaTime = Date.now() - this.timeStarted;
            this.audioEngine.playSound(this.deltaTime);
            //this.videoPlayer.updateTimeDisplay(this.clock.totalTimePlayed(this.timeStarted, this.totalTimePaused), "0:33");

            //this.videoPlayer.update(this.buffer.getFrameAt(this.testCounter), this.testCounter);
            this.videoPlayer.update(this.deltaTime);
            //this.testCounter = (this.testCounter + 1) % 151;

        }

    },
    /**
     * Sets the time started 
     * @memberof Flare.MediaPlayer.prototype
     * @function setStartTime
     * @param {number} time time at which playback starts
     */
    setStartTime: function (time) {
        this.timeStarted = time;
    },
    /**
     * Sets paused time
     * @memberof Flare.MediaPlayer.prototype
     * @function setPauseTime
     * @param {number} time time at which playback pauses
     */
    setPauseTime: function (time) {
        this.timePaused = time;
    },
    /**
     * Switches between play and pause mode
     * @memberof Flare.MediaPlayer.prototype
     * @function togglePlay
     */
    togglePlay: function () {

        if (this.isPlaying) {
            this.isPlaying = false;
            this.clock.setPauseTime(Date.now());
            this.timePaused = Date.now();
            this.audioEngine.stopSound();
        } else {
            this.isPlaying = true;


            if (this.timePaused === 0) {
                this.setStartTime(Date.now());
            } else {
                this.setStartTime(Date.now() - this.deltaTime);
            }
            //this.audioEngine.playSound(Date.now() - this.timeStarted);
            /*
             if(this.numPressedPlay > 0){
             this.totalTimePaused += Date.now() - this.clock.getPauseTime();
             }
             this.numPressedPlay++;
             */
        }
    },
    /**
     * Resets the timeline
     * @memberof Flare.MediaPlayer.prototype
     * @function reset
     */
    reset: function () {
        //reset all counters
        this.timePaused = 0;
        this.timeStarted = 0;
        this.deltaTime = 0;
    },
    /**
     * Is currently in play mode
     * @memberof Flare.MediaPlayer.prototype
     * @function isPlayMode
     * @return {boolean} is currently playing
     */
    isPlayMode: function () {
        return this.isPlaying;
    },
    /**
     * Gets number of times play was pressed
     * @memberof Flare.MediaPlayer.prototype
     * @function getNumPressedPlay
     * @return {number} number of times play was pressed
     */
    getNumPressedPlay: function () {
        return this.numPressedPlay;
    },
    /**
     * callback for when the end of the timeline has been reached
     * @memberof Flare.MediaPlayer.prototype
     * @function finishPlayback
     */
    finishPlayback: function () {
        this.isPlaying = false;
        this.audioEngine.stopSound();
        this.reset();

    }


};

Flare.MediaPlayer.prototype.constructor = Flare.MediaPlayer;
/**
 * class for handling the canvas element
 * @author Fredrik Sigvartsen and Brian Parra and Jens Omfjord
 * @memberOf Flare
 * @class Flare.VideoPlayer
 * @constructor
 * @param {Flare.MediaPlayer} mediaPlayer a reference to the mediaPlayer
 * @return {Flare.VideoPlayer} returns a Flare VideoPlayer
 */
Flare.VideoPlayer = function (mediaPlayer) {


    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer = mediaPlayer;

    /**
     * @property {object} canvas reference to the canvas object
     */
    this.canvas = null;

    /**
     * @property {number} videoWidth the video width
     */
    this.videoWidth;

    /**
     * @property {number} videoHeight the video height
     */
    this.videoHeight;

    /**
     * @property {object} videoPlayer the DOM video player container element
     */
    this.videoPlayer;

    /**
     * @property {object} controlBar the wrapper for the bottom control bar
     */
    this.controlBar;

    /**
     * @property {object} progressBarContainer the container for the progress bars
     */
    this.progressBarContainer;

    /**
     * @property {object} playButton the play button
     */
    this.playButton;

    /**
     * @property {object} controlBarInner the inner wrapper for the control bar
     */
    this.controlBarInner;

    /**
     * @property {object} leftControls a left floated div for the controls on the left of the bar
     */
    this.leftControls;

    /**
     * @property {object} rightControls a left floated div for the controls on the right of the bar
     */
    this.rightControls;

    /**
     * @property {object} settingsButton the settings button
     */
    this.settingsButton;

    /**
     * @property {string} settingsPath the svg path for the settings button
     */
    this.settingsPath;

    /**
     * @property {object} progressBar the bar that shows the timeline progress
     */
    this.progressBar;

    /**
     * @property {object} progressBarDisplayGroup wrapper for the different progress bars like buffering and playback
     */
    this.progressBarDisplayGroup;

    /**
     * @property {object} loadProgressBar shows buffer status
     */
    this.loadProgressBar;

    /**
     * @property {object} playProgress shows play progress in %
     */
    this.playProgress;

    /**
     * @property {object} timeDisplay shows formated time display
     */
    this.timeDisplay;

    /**
     * @property {object} volumeControl wrapper for volume slider
     */
    this.volumeControl;

    /**
     * @property {object} muteButton mute button
     */
    this.muteButton;

    /**
     * @property {object} loadingBar shows spinning wheel
     */
    this.loadingBar;

    /**
     * @property {boolean} buttonsLocked are the buttons currently locked
     */
    this.buttonsLocked = false;

    /**
     * @property {number} durationInMin the duration in min
     */
    this.durationInMin = 0;

    /**
     * @property {number} fps the frames per second
     */
    this.fps;

    this.muteButtonStyle = {
        background: 'none',
        border: 'none',
        color: 'white'
    };

    this.volumeControlStyle = {
        display: 'inline-block'

    };

    this.loadProgressBarStyle = {
        position: 'absolute',
        bottom: 0,
        left: '0px',
        'background-color': 'rgba(255,255,255,0.4)',
        height: '100%',
        width: '100%',
        'transform-origin': '0 0 '
    };

    this.timeDisplayStyle = {
        display: 'inline-block',
        padding: '0 5px',
        'line-height': '30px',
        color: 'rgba(255,255,255,0.95)',
        'font-family': 'Verdana, Geneva, sans-serif',
        'font-size': '12px'
    };

    this.playProgressStyle = {
        'z-index': 2,
        position: 'absolute',
        bottom: 0,
        left: '0px',
        'background-color': 'rgba(0,0,255,0.4)',
        height: '100%',
        width: '100%',
        'transform-origin': '0 0 '
    };

    this.progressBarDisplayGroupStyle = {
        height: '100%',
        //transform: 'scaleY(0.5)',
        transition: 'transform .1s cubic-bezier(0.4,0.0,1,1)',
        'background-color': 'rgba(255,255,255,0.3)',
        'transform-origin': 'bottom'


    };

    this.progressBarStyle = {
        position: 'absolute',
        bottom: 0,
        left: 0,
        width: '100%',
        height: '100%',
        'touch-action': 'none'

    };

    this.progressBarAttribtues = {
        role: 'slider',
        draggable: 'true',
        'aria-valuemin': 0,
        'aria-valuemax': 100,
        'aria-valuenow': 0,
        //'tabindex' : 0

    };

    this.rightControlsStyle = {
        float: 'right',
        height: '100%'
    };



    this.leftControlsStyle = {
        float: 'left',
        height: '100%'
    };

    this.videoPlayerStyle = {
        position: 'relative',
        overflow: 'hidden',
        width: '960px',
        height: '540px',
        display: 'inline-block',
        'font-family': 'Arial'

    };

    this.controlBarInnerStyle = {
    };

    this.controlBarStyle = {
        height: '30px',
        position: 'absolute',
        bottom: '0',
        left: 0,
        right: 0,
        'background-color': 'rgba(0,0,0,0.5)'
    };

    this.playButtonStyle = {
        color: 'white',
        'font-size': '20px',
        background: 'transparent',
        border: 'none',
        cursor: 'pointer',
        width: '30px'

    };

    this.progressBarContainerStyle = {
        width: '100%',
        position: 'absolute',
        height: '5px',
        bottom: '30px',
        cursor: 'pointer'
    };

    this.loadingBarStyle = {
        position: 'absolute',
        left: '40%',
        top: '30%',
        right: '0px',
        bottom: '0px',
        width: '100%',
        height: '100%',
        'z-index': '99',
        background: "url('../src/images/page-loader.gif')",
        'background-repeat': 'no-repeat'
    };

    return this;



};

Flare.VideoPlayer.prototype = {
    /**
     * Boots up the VideoPlayer and creates the Dom Elements
     * @memberof Flare.VideoPlayer.prototype
     * @function boot
     */
    boot: function () {

        this.videoPlayer = document.createElement("div");
        this.loadingBar = document.createElement("div");
        this.controlBar = document.createElement("div");
        this.progressBarContainer = document.createElement("div");
        this.leftControls = document.createElement("div");
        this.rightControls = document.createElement("div");
        this.controlBarInner = document.createElement("div");
        this.playButton = document.createElement("button");
        this.muteButton = document.createElement("button");
        this.volumeControl = document.createElement("div");
        this.progressBar = document.createElement("div");
        this.loadProgressBar = document.createElement("div");
        this.progressBarDisplayGroup = document.createElement("div");
        this.controlBarInner = document.createElement("div");
        this.playProgress = document.createElement("div");
        this.timeDisplay = document.createElement("div");
        this.settingsButton = document.createElement("svg");
        this.settingsPath = document.createElementNS('http://www.w3.org/2000/svg', "path");



        this.settingsPath.setAttributeNS(null, "d", Flare.Icons.settings);
        this.videoPlayer.id = "videoId";

        this.playButton.innerHTML = "&amp;#9658;";
        this.muteButton.innerHTML = "&amp;#9732;";


        this.canvas = new Flare.Canvas(this);


        this.setStyle(this.videoPlayer, this.videoPlayerStyle);
        this.setStyle(this.controlBar, this.controlBarStyle);
        this.setStyle(this.playButton, this.playButtonStyle);
        this.setStyle(this.progressBarContainer, this.progressBarContainerStyle);
        this.setStyle(this.leftControls, this.leftControlsStyle);
        this.setStyle(this.rightControls, this.rightControlsStyle);
        this.setStyle(this.progressBar, this.progressBarStyle);
        this.setStyle(this.progressBarDisplayGroup, this.progressBarDisplayGroupStyle);
        this.setStyle(this.playProgress, this.playProgressStyle);
        this.setStyle(this.timeDisplay, this.timeDisplayStyle);
        this.setStyle(this.volumeControl, this.volumeControlStyle);
        this.setStyle(this.muteButton, this.muteButtonStyle);
        this.setStyle(this.loadingBar, this.loadingBarStyle);
        this.setStyle(this.loadProgressBar, this.loadProgressBarStyle);


        this.setAttributes(this.progressBar, this.progressBarAttribtues);

        this.settingsButton.appendChild(this.settingsPath);
        this.videoPlayer.appendChild(this.canvas.getCanvas());
        this.controlBarInner.appendChild(this.leftControls);
        this.controlBarInner.appendChild(this.rightControls);
        //this.volumeControl.appendChild(this.muteButton);
        this.leftControls.appendChild(this.playButton);
        this.leftControls.appendChild(this.volumeControl);
        this.leftControls.appendChild(this.timeDisplay);
        this.rightControls.appendChild(this.settingsButton);
        this.progressBarContainer.appendChild(this.progressBar);
        this.progressBar.appendChild(this.progressBarDisplayGroup);
        this.progressBarDisplayGroup.appendChild(this.playProgress);
        this.progressBarDisplayGroup.appendChild(this.loadProgressBar);
        this.controlBar.appendChild(this.progressBarContainer);
        this.controlBar.appendChild(this.controlBarInner);

        //BIND HANDLERS
        this.progressBar.onmousedown = this.handleMouseDown.bind(this);
        this.progressBar.ondragstart = this.handleDragStart.bind(this);
        this.progressBar.ondrag = this.handleDrag.bind(this);
        this.progressBar.ondragend = this.handleDragEnd.bind(this);
        this.playButton.onclick = this.handlePlayButtonPress.bind(this);


        this.videoPlayer.appendChild(this.controlBar);
        this.videoPlayer.appendChild(this.loadingBar);
        if (!this.mediaPlayer.buffer.isLoaded) {
            this.toggleLockingButtons();
        }


        this.updatePlayProgress(0.0);
        this.updateLoadProgress(0.0);



        var target;
        var parent = this.mediaPlayer.options.container;


        if (parent) {
            if (typeof parent === 'string') {
                target = document.getElementById(parent);
            } else if (typeof parent === 'object' &amp;&amp; parent.nodeType === 1) {
                target = parent;
            }
        }

        // Fallback, covers an invalid ID and a non HTMLelement object
        if (!target) {

            target = document.body;
        }
        console.log(target);
        target.appendChild(this.videoPlayer);
    },
    /**
     * On each update (hopefully 60fps) update the UI
     * @memberof Flare.VideoPlayer.prototype
     * @function update
     * @param {number} the current time of the video
     */
    update: function (videoTime) {
        //calculate which frame number, get that frame from buffer
        //video time is in ms
        var progress = (videoTime / 1000) / this.mediaPlayer.buffer.getDuration();

        if (progress >= 1.0) {
            this.mediaPlayer.finishPlayback();
            return;
        }

        var frameNumber = Math.floor((videoTime / 1000) * this.fps);
        //console.log(progress + "progress");
        //console.log (frameNumber + "frame num");
        this.canvas.render(this.mediaPlayer.buffer.getFrameAt(frameNumber));

        this.updatePlayProgress(progress);
        this.updateTimeDisplay(videoTime);

    },
    /**
     * Utility function for setting styles of an element
     * @memberof Flare.VideoPlayer.prototype
     * @function setStyle
     * @param {object} element Dom element to add styles to
     * @param {array} attributes attributes to add 
     */
    setStyle: function (element, attributes) {

        for (var attribute in attributes) {
            element.style.setProperty(attribute, attributes[attribute]);
        }


    },
    /**
     * Utility function for setting attributes of an element
     * @memberof Flare.VideoPlayer.prototype
     * @function setAttributes
     * @param {object} element Dom element to add attributes to
     * @param {array} attributes attributes to add 
     */
    setAttributes: function (element, attributes) {

        for (var attribute in attributes) {
            element.setAttribute(attribute, attributes[attribute]);
        }
    },
    /**
     * Updates the progress in the timeline display
     * @memberof Flare.VideoPlayer.prototype
     * @function updatePlayProgress
     * @param {number} progress the progress in %
     */
    updatePlayProgress: function (progress) {
        this.playProgress.style.setProperty("transform", "scaleX(" + progress + ")");
        this.progressBar.setAttribute("aria-valuenow", parseInt(progress * 100));
    },
    /**
     * Updates the progress in the buffering display
     * @memberof Flare.VideoPlayer.prototype
     * @function updateLoadProgress
     * @param {number} progress the progress in %
     */
    updateLoadProgress: function (progress) {
        this.loadProgressBar.style.setProperty("transform", "scaleX(" + progress + ")");
        //this.progressBar.setAttribute("aria-valuenow", parseInt(progress * 100));
    },
    /**
     * Bind callback for mouse down on timeline
     * @memberof Flare.VideoPlayer.prototype
     * @function handleMouseDown
     * @param {object} e the mouse event
     */
    handleMouseDown: function (e) {
        console.log(e);
        var currentProgress = parseInt(this.progressBar.getAttribute('aria-valuenow'));
        this.mediaPlayer.isPlaying = false;

        return false;
    },
    /**
     * Bind callback for mouse drag starts
     * @memberof Flare.VideoPlayer.prototype
     * @function handleDragStart
     * @param {object} e the mouse event
     */
    handleDragStart: function (e) {

        console.log(e);

    },
    /**
     * Bind callback for mouse drag. Use this for dragging the timeline and repositioning playback
     * @memberof Flare.VideoPlayer.prototype
     * @function handleDrag
     * @param {object} e the mouse event
     */
    handleDrag: function (e) {

        //Make new indicator to show the drag location

        //First get position of cursor depending on location

        //Calculate percentage

        //Now set the valuenow to the % progress
        console.log(e);

    },
    /**
     * Bind callback for mouse drag ends, start playing again if was previously playing
     * @memberof Flare.VideoPlayer.prototype
     * @function handleDragEnd
     * @param {object} e the mouse event
     */
    handleDragEnd: function (e) {

        //if in play mode, continue playing from new location
        //buffer if neccessary

    },
    /**
     * Bind callback for play button. Toggle playback here
     * @memberof Flare.VideoPlayer.prototype
     * @function handlePlayButtonPress
     * @param {object} e the mouse event
     */
    handlePlayButtonPress: function (e) {
        console.log("play clicked");
        this.mediaPlayer.togglePlay();

        if (this.mediaPlayer.isPlayMode()) {
            this.playButton.innerHTML = "||";
        } else {
            this.playButton.innerHTML = "&amp;#x025B8;";
        }

    },
    /**
     * Updates the numerical time display in formated min/sec
     * @memberof Flare.VideoPlayer.prototype
     * @function handlePlayButtonPress
     * @param {number} videoTime the time in the video
     */
    updateTimeDisplay: function (videoTime) {
        this.timeDisplay.innerHTML = this.formatTimeFromMiliSeconds(videoTime) + " / " + this.durationInMin;
    },
    /**
     * Utility function to format time in seconds into a string
     * @memberof Flare.VideoPlayer.prototype
     * @function formatTimeFromSeconds
     * @param {number} timeInSeconds video time in seconds
     * @return {string} formated time
     */
    formatTimeFromSeconds: function (timeInSeconds) {
        var totalSeconds = Math.floor(timeInSeconds);
        var min = Math.floor(totalSeconds / 60);
        var seconds = totalSeconds % 60;
        var formattedTime = this.formatDigits(min) + ":" + this.formatDigits(seconds);

        return formattedTime;
    },
    /**
     * Utility function to format time in ms into a string
     * @memberof Flare.VideoPlayer.prototype
     * @function formatTimeFromMiliSeconds
     * @param {number} timeInMS video time in ms
     * @return {string} formated time
     */
    formatTimeFromMiliSeconds: function (timeInMs) {
        return this.formatTimeFromSeconds(timeInMs / 1000);
    },
    /**
     * Utility function to format the leading 0
     * @memberof Flare.VideoPlayer.prototype
     * @function formatDigits
     * @param {number} time to format
     * @return {string} formated time with leading 0 if single digit
     */
    formatDigits: function (time) {
        if (time > 9)
            return time
        else
            return "0" + time;
    },
    /**
     * Removes loading animation once loaded
     * @memberof Flare.VideoPlayer.prototype
     * @function removeLoadingBar
     */
    removeLoadingBar: function () {
        this.videoPlayer.removeChild(this.loadingBar);
    },
    /**
     * Locks and unlocks the ui buttons
     * @memberof Flare.VideoPlayer.prototype
     * @function toggleLockingButtons
     */
    toggleLockingButtons: function () {
        if (this.buttonsLocked) {
            this.playButton.removeAttribute("disabled");
            this.muteButton.removeAttribute("disabled");
            this.volumeControl.removeAttribute("disabled");
            this.progressBar.removeAttribute("disabled");
            this.settingsButton.removeAttribute("disabled");

            this.buttonsLocked = false;
        } else { // lock buttons
            this.playButton.setAttribute("disabled", "disabled");
            this.muteButton.setAttribute("disabled", "disabled");
            this.volumeControl.setAttribute("disabled", "disabled");
            this.progressBar.setAttribute("disabled", "disabled");
            this.settingsButton.setAttribute("disabled", "disabled");
            this.buttonsLocked = true;
        }
    },
    /**
     * Sets the duration of the video 
     * @memberof Flare.VideoPlayer.prototype
     * @function setDuration
     * @param {number} duration duration in seconds
     */
    setDuration: function (duration) {
        console.log(this.formatTimeFromSeconds(duration) + "loading");
        this.durationInMin = this.formatTimeFromSeconds(duration);
        this.updateTimeDisplay(0);

    },
    /**
     * Sets the fps
     * @param {number} fps frames per second
     */
    setFps: function (fps) {
        this.fps = fps;
    },
};

Flare.VideoPlayer.prototype.constructor = Flare.VideoPlayer;
/**
 * "Abstract" class for FlareMessage
 * @author Brian Parra
 * @memberOf Flare
 * @class Flare.FlareMessage
 * @constructor
 * @return {Flare.FlareMessage} returns a FlareMessage
 */
Flare.FlareMessage = function () {
    this.flareOpCode; //1 byte

    this.totalMessageLength; //int
    this.dataLength; // int

    this.headerLength = 5;

    return this;
};

Flare.FlareMessage.prototype = {
    /**
     * A function that adds a string to a binary dataView at a designated offset
     * @memberof Flare.FlareMessage.prototype
     * @function addStringToBinary
     * @param {object} dataView the binary dataView object
     * @param {number} offset the integer offset in the dataview
     * @param {string} string the string to add
     * 
     */
    addStringToBinary: function (dataView, offset, string) {

        dataView.setUint8(offset, (string.length &amp; 0xff));//Add The length of string

        for (var index = 0; index &lt; string.length; index++) {
            dataView.setUint8(index + 1 + offset, string.charCodeAt(index));
        }




    }


};

Flare.Buffer.prototype.constructor = Flare.FlareMessage;






/**
 * Message for requesting a video
 * @author Brian Parra
 * @memberOf Flare
 * @class Flare.OpenVideoMessage
 * @augments Flare.FlareMessage
 * @constructor
 * @return {Flare.OpenVideoMessage} returns an OpenVideoMessage
 */
Flare.OpenVideoMessage = function () {

    Flare.FlareMessage.call(this);//Inherit from flaremessage

    this.flareOpCode = Flare.OpCode.OPEN_VIDEO;

    this.requestFile = "";

    return this;



};

Flare.OpenVideoMessage.prototype = Object.create(Flare.FlareMessage.prototype);
Flare.OpenVideoMessage.prototype.constructor = Flare.OpenVideoMessage;


/**
 * Sets the requestID of desired video
 * @memberof Flare.OpenVideoMessage.prototype
 * @function setRequestFile
 * @param {string} requestFile the string of the request ID
 */
Flare.OpenVideoMessage.prototype.setRequestFile = function (requestFile) {

    this.requestFile = requestFile;

};

/**
 * Turns the entire message into a binary array for sending
 * @memberof Flare.OpenVideoMessage.prototype
 * @function toBinary
 * @return {object} data view of binary
 */
Flare.OpenVideoMessage.prototype.toBinary = function () {

    this.dataLength = this.requestFile.length + 1;
    this.totalMessageLength = this.dataLength + this.headerLength;

    var data = new ArrayBuffer(this.totalMessageLength);
    var dataView = new DataView(data);





    dataView.setInt8(0, (this.flareOpCode &amp; 0xff));//Set The Op Code
    dataView.setInt32(1, (this.totalMessageLength &amp; 0xffffffff));//Set The Op Code

    this.addStringToBinary(dataView, this.headerLength, this.requestFile); // add the request string

    return data;


};









/**
 * Flare OpCodes
 * @author Brian Parra
 * @memberOf Flare
 * @type {object}
 * @constant
 */

Flare.OpCode = {
    //Put Constant values here

    OPEN_VIDEO : 0,
    FRAME : 1,
    AUDIO : 2



};

/**
 * Hash map of FlareTasks for corresponding Flare OpCodes
 * @author Brian Parra
 * @memberOf Flare
 * @type {object}
 * @constant
 */
Flare.TaskTable = {};
Flare.TaskTable[Flare.OpCode.OPEN_VIDEO] = Flare.InitializeVideoTask;
Flare.TaskTable[Flare.OpCode.FRAME] = Flare.ProcessFrameTask;
Flare.TaskTable[Flare.OpCode.AUDIO] = Flare.ProcessAudioTask;
/**
 * Image data should be stored here as svg data
 * @author Brian Parra
 * @memberOf Flare
 * @type {object}
 * @constant
 */
Flare.Icons = {

/**
 * @memberOf Flare.Icons
 * @type {string}
 */
settings :
        "M863.24,382.771l-88.759-14.807c-6.451-26.374-15.857-51.585-28.107-75.099l56.821-70.452   c12.085-14.889,11.536-36.312-1.205-50.682l-35.301-39.729c-12.796-14.355-34.016-17.391-50.202-7.165l-75.906,47.716   c-33.386-23.326-71.204-40.551-112-50.546l-14.85-89.235c-3.116-18.895-19.467-32.759-38.661-32.759h-53.198   c-19.155,0-35.561,13.864-38.608,32.759l-14.931,89.263c-33.729,8.258-65.353,21.588-94.213,39.144l-72.188-51.518   c-15.558-11.115-36.927-9.377-50.504,4.171l-37.583,37.61c-13.548,13.577-15.286,34.946-4.142,50.504l51.638,72.326   c-17.391,28.642-30.584,60.086-38.841,93.515l-89.743,14.985C13.891,385.888,0,402.24,0,421.435v53.156   c0,19.193,13.891,35.547,32.757,38.663l89.743,14.985c6.781,27.508,16.625,53.784,29.709,78.147L95.647,676.44   c-12.044,14.875-11.538,36.312,1.203,50.669l35.274,39.73c12.797,14.382,34.028,17.363,50.216,7.163l77-48.37   c32.581,22.285,69.44,38.664,108.993,48.37l14.931,89.25c3.048,18.896,19.453,32.76,38.608,32.76h53.198   c19.194,0,35.545-13.863,38.661-32.759l14.875-89.25c33.308-8.147,64.531-21.245,93.134-38.5l75.196,53.705   c15.53,11.155,36.915,9.405,50.478-4.186l37.598-37.597c13.532-13.536,15.365-34.893,4.127-50.479l-53.536-75.059   c17.441-28.738,30.704-60.238,38.909-93.816l88.758-14.82c18.921-3.116,32.756-19.469,32.756-38.663v-53.156   C895.998,402.24,882.163,385.888,863.24,382.771z M449.42,616.013c-92.764,0-168-75.25-168-168c0-92.764,75.236-168,168-168   c92.748,0,167.998,75.236,167.998,168C617.418,540.763,542.168,616.013,449.42,616.013z"



        };

/**
 * class for handling audio engine
 * @author Brian Parra
 * @memberOf Flare
 * @class Flare.NetworkManager
 * @constructor
 * @param {Flare.MediaPlayer} mediaPlayer a reference to the mediaPlayer
 * @return {Flare.NetworkManager} returns a Flare AudioEngine
 */
Flare.NetworkManager = function (mediaPlayer) {


    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer = mediaPlayer;

    /**
     * @property {object} socket the websocket connection
     */
    this.socket;

    /**
     * @property {boolean} is the connection opened
     */
    this.connected = false;




    this.connect();
    this.setup();



    return this;



};

Flare.NetworkManager.prototype = {
    /**
     * This function connects the websocket
     * @memberof Flare.NetworkManager.prototype
     * @function connect
     */
    connect: function () {
        var connectionUrl = 'ws://' + this.mediaPlayer.options.uri + ':' + this.mediaPlayer.options.port;
        this.socket = new WebSocket(connectionUrl);
        this.socket.binaryType = 'arraybuffer';
    },
    /**
     * Closes the connection
     * @memberof Flare.NetworkManager.prototype
     * @function close
     */
    close: function () {

        this.socket.close();
    },
    /**
     * Binds all handlers to websocket
     * @memberof Flare.NetworkManager.prototype
     * @function setup
     */
    setup: function () {

        this.socket.onopen = this.onOpen.bind(this);
        this.socket.onclose = this.onClose.bind(this);
        this.socket.onmessage = this.onMessage.bind(this);
        this.socket.onerror = this.onError.bind(this);

    },
    /**
     * Onopen event handler
     * @memberof Flare.NetworkManager.prototype
     * @function onOpen
     */
    onOpen: function () {

        this.connected = true;
        console.log("connection Opened");
        //this.socket.send("hello");
        //this.requestVideo(this.mediaPlayer.options.videoPath);
        this.requestVideo();


    },
    /**
     * Close event handler
     * @memberof Flare.NetworkManager.prototype
     * @function onCloser
     */
    onClose: function (message) {
        console.log("closed");
        console.log(message);
    },
    /**
     * OnMessage event handler, process incoming data here
     * @memberof Flare.NetworkManager.prototype
     * @function onMessage
     */
    onMessage: function (message) {

        if (message.data instanceof ArrayBuffer) {


            //All incoming binary should be images
            //console.log(message);
            var dataView = new DataView(message.data);
            var opCode = dataView.getInt8(4);
            var dataLength = dataView.getUint32(0);
            //console.log("lenth " + dataLength);
            //console.log("opCode " + opCode);


            var task = new Flare.TaskTable[opCode];
            task.setData(message.data);
            task.setMediaPlayer(this.mediaPlayer);
            task.process();


        } else if (typeof message.data === "string") {

            //Process as json

            var data = JSON.parse(message.data);
            console.log(data.test);


        }
        //var data = message.data;

    },
    /**
     * Handler websocket errors here
     * @memberof Flare.NetworkManager.prototype
     * @function onError
     */
    onError: function (e) {
        console.log(e);
    },
    /**
     * Sends data
     * @memberof Flare.NetworkManager.prototype
     * @function send
     * @param {object} data binary data to send
     */
    send: function (data) {

        this.socket.send(data);

    },
    /**
     * Once the connection is opened, this function requests a video
     * @memberof Flare.NetworkManager.prototype
     * @function requestVideo
     */
    requestVideo: function () {

        var videoRequest = new Flare.OpenVideoMessage();
        videoRequest.setRequestFile(this.mediaPlayer.options.videoID);


        //console.log(videoRequest.toBinary());
        this.socket.send(videoRequest.toBinary());


    }

};

Flare.NetworkManager.prototype.constructor = Flare.NetworkManager;

    if (typeof exports !== 'undefined') {
        if (typeof module !== 'undefined' &amp;&amp; module.exports) {
            exports = module.exports = Flare;
        }
        exports.Flare = Flare;
    } else if (typeof define !== 'undefined' &amp;&amp; define.amd) {
        define('Flare', (function() { return root.Flare = Flare; })() );
    } else {
        root.Flare = Flare;
    }

    return Flare;
    
}).call(this);
/**
 * Class for keeping track of time
 * @author Brian Parra
 * @memberOf Flare
 * @class Flare.Clock
 * @constructor
 * @param {Flare.MediaPlayer} mediaPlayer a reference to the mediaPlayer
 * @return {Flare.Clock} returns a Flare AudioEngine
 */

Flare.Clock = function (mediaPlayer) {


    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer = mediaPlayer;

    /**
     * @property {number} _timeInitialized the time the clock has started
     */
    this._timeInitialized = 0;

    /*
     * @property {number} elapsed time elapsed
     */
    this.elapsed = 0;

    /*
     * @property {number} elapsedMs time elapsed in ms
     */
    this.elapsedMs = 0;

    /*
     * @property {number} previousTime previous clock update time
     */
    this.previousTime = 0;

    /*
     * @property {number} currentTime the current time
     */
    this.currentTime = 0;

    /*
     * @property {number} timeUpdated the time updated
     */
    this.timeUpdated = 0;

    /*
     * @property {number} lastTimeUpdated last time updated
     */
    this.lastTimeUpdated = 0;

    /*
     * @property {number} timeStarted time when the clock was started
     */
    this.timeStarted = 0;

    /*
     * @property {number} timePaused time when paused
     */
    this.timePaused = 0;

    /*
     * @property {number} time getneric time holder
     */
    this.time = 0;

    /*
     * @property {number} minutes minutes played
     */
    this.minutes = 0;

    return this;


};

Flare.Clock.prototype = {
    /**
     * Boot function for the clock
     * @memberof Flare.Clock.prototype
     * @function boot
     * 
     */
    boot: function () {
        this._timeInitialized = Date.now();
        this.timeUpdated = Date.now();
    },
    /**
     * On each refresh, adjust all the time holders
     * @memberof Flare.Clock.prototype
     * @function refresh
     * 
     */
    refresh: function () {

        //  Set to the old Date.now value
        this.lastTimeUpdated = this.timeUpdated;

        // this.time always holds a Date.now value
        this.timeUpdated = Date.now();

        //  Adjust accordingly.
        this.elapsedMs = this.timeUpdated - this.lastTimeUpdated;

    },
    /**
     * The function thats called on update
     * @memberof Flare.Clock.prototype
     * @function update
     * @param {number} time  time updated
     * 
     */
    update: function (time) {


        this.lastTimeUpdated = this.timeUpdated;

        // this.time always holds a Date.now value
        this.timeUpdated = Date.now();

        this.elapsedMS = this.timeUpdated - this.lastTimeUpdated;

        this.previousTime = this.currentTime;

        this.currentTime = time;

        this.elapsed = this.currentTime - this.previousTime;

    },
    /**
     * Get the total time played
     * @memberof Flare.Clock.prototype
     * @function totalTimePlayed
     * @param {number} startTime time Started
     * @param {number} pauseTime time paused
     * @return {string} formated time string
     */
    totalTimePlayed: function (startTime, pauseTime) {
        if (startTime === 0) {    //video has not started playing yet
            return 0;
        }
        this.time = ((Date.now() - startTime) - pauseTime) / 1000;
        var seconds = Math.floor(this.time * 1) / 1;
        if (seconds > 59) {
            this.minutes++;
            this.time = 0;
            seconds = 0;
            this.mediaPlayer.setStartTime(Date.now());
        }
        if (seconds &lt; 10) {
            return this.minutes + ":0" + seconds;
        }
        return this.minutes + ":" + seconds;
    },
    /**
     * Get the last tiem paused
     * @memberof Flare.Clock.prototype
     * @function getPauseTime
     * @return {number} time paused
     * 
     */
    getPauseTime: function () {
        return this.timePaused;
    },
    /**
     * Set time paused
     * @memberof Flare.Clock.prototype
     * @function setPauseTime
     * @param {number} time paused
     * 
     */
    setPauseTime: function (time) {
        this.timePaused = time;
    }

};

Flare.Clock.prototype.constructor = Flare.Clock;
/**
 * class for handling audio engine
 * @author Brian
 * @memberOf Flare
 * @class Flare.Oscillator
 * @constructor
 * @param {Flare.MediaPlayer} mediaPlayer a reference to the mediaPlayer
 * @return {Flare.Oscillator} returns an Oscillator
 */

Flare.Oscillator = function (mediaPlayer) {


    /**
     * @property {Flare.VideoPlayer} mediaPlayer - A reference to the mediaPlayer.
     */
    this.mediaPlayer = mediaPlayer;

    /**
     * @property {boolean} running is the oscillator running
     */
    this.running = false;

    /**
     * @property {function} _loopFunction this is the function that is continuously called
     */
    this._loopFunction = null;

    /**
     * @property {number} _eventId the id of the timeout event
     */
    this._eventId = null;

    /**
     * @property {number} fps the frames per second
     */
    this.fps = 30; // Testing for now

    /**
     * @property {number} speed at which the updates are occuring
     */
    this.updateSpeed = 0;

    /**
     * @property {boolean} usingSetTimeOut is SetTimeOut being used for loop
     */
    this.usingSetTimeOut = false;

    /**
     * @property {boolean} usingRequestAnimationFrame is RequestAnimationFrame being used for loop
     */
    this.usingRequestAnimationFrame = false;

    return this;


};

Flare.Oscillator.prototype = {
    /**
     * This is the main function to start the loops
     * @memberof Flare.Oscillator.prototype
     * @function run
     */
    run: function () {

        this.running = true;
        var _this = this;
        this.updateSpeed = Math.floor(1000 / this.fps);

        //if window.requestAnimationFrame is not available, use setTimeout
        if (!window.requestAnimationFrame) {

            this.usingSetTimeOut = true;

            this._loopFunction = function () {
                return _this.updateSetTimeout();
            };

            this._eventId = window.setTimeout(this._loopFunction, 0);



        } else {

            this.usingRequestAnimationFrame = true;

            this._loopFunction = function (time) {
                return _this.updateRequestAnimationFrame(time);
            };

            this._eventId = window.requestAnimationFrame(this._loopFunction);


        }

    },
    /**
     * Stop running the update loop
     * @memberof Flare.Oscillator.prototype
     * @function stop
     */
    stop: function () {

        if (this.usingSetTimeOut) {

            clearTimeout(this._eventId);

        } else {

            window.cancelAnimationFrame(this._eventId);
        }

        this.running = false;

    },
    /**
     * This is the loop function using RequestAnimationFrame
     * @memberof Flare.Oscillator.prototype
     * @param {number} time update time
     * @function updateRequestAnimationFrame
     */
    updateRequestAnimationFrame: function (time) {

        this.mediaPlayer.update(Math.floor(time));

        this._eventId = window.requestAnimationFrame(this._loopFunction);

    },
    /**
     * This is the loop function using updateSetTimeout
     * @memberof Flare.Oscillator.prototype
     * @function updateRequestAnimationFrame
     */
    updateSetTimeout: function () {

        this.mediaPlayer.update(Date.now());

        this._eventId = window.setTimeout(this._loopFunction, this.updateSpeed);

    }

};

Flare.Oscillator.prototype.constructor = Flare.Oscillator;
/**
 * class for handling device specific apis
 * @author Fredrik
 * @memberOf Flare
 * @class Flare.AudioEngine
 * @constructor
 */

Flare.Device = function () {

    /*
     * @property {number} deviceReadyAt time device was initialized at
     */
    this.deviceReadyAt = 0;

    /*
     * @property {boolean} initialized if the device has initialized
     */
    this.initialized = false;

    /**
     * @property {boolean} isCompatible is the current device compatible
     */
    this.isCompatible = false;

    /**
     * @property {boolean} hasGeneralInputTypes does this device have inputs
     */
    this.hasGeneralInputTypes = false;

    /**
     * @property {boolean} hasCanvas is the canvas available
     */
    this.hasCanvas = false;

    /**
     * @property {boolean} hasWebGL does the device have WebGl
     */
    this.hasWebGL = false;

    /**
     * @property {boolean} does the device have File reading/writing capabilities
     */
    this.hasFile = false;

    /**
     * @property {boolean} hasLocalStorage can store local data
     */
    this.hasLocalStorage = false;

    /**
     * @property {boolean} hasTypedArray is typed array available
     */
    this.hasTypedArray = false;

    /**
     * @property {boolean} hasTouch is touch input available
     */
    this.hasTouch = false;

    /**
     * @property {boolean} hasWebAudio is webAudio available
     */
    this.hasWebAudio = false;

    /**
     * @property {boolean} fullscreen  is fullscreen available
     */
    this.fullscreen = false;

    /**
     * @property {boolean} webSocket is websocket available
     */
    this.webSocket = false;
};


//Make Singleton
Flare.Device = new Flare.Device();


/**
 * All device initialization goes here, including feature checking
 * @memberof Flare.Device
 * @function _initialize
 */
Flare.Device._initialize = function () {


    function supportsCanvas() {

        var c = document.createElement('canvas');
        return !!c.getContext;

    }

    function supportsWebAudio() {
        var hasWebKitAudio = 'webkitAudioContext' in window;
        var hasAudioContext = 'AudioContext' in window;

        if (!(hasWebKitAudio || hasAudioContext)) {
            var audioElement = document.createElement('audio');
            return audioElement.canPlayType;
        }
        return true;
    }

    function supportsWebGL() {
        try {
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        } catch (e) {
            return false;
        }
        return !!ctx;
    }

    function supportsHTML5Storage() {
        try {
            return 'localStorage' in window &amp;&amp; window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    }

    function supportsCss3D() {
        if (!!window.getComputedStyle) { //  The browser does not support getComputedStyle
            return false;
        }
        var element = document.createElement('p'); //Creating a random element
        var transforms = {
            'webkitTransform': '-webkit-transform',
            'OTransform': '-o-transform',
            'msTransform': '-ms-transform',
            'MozTransform': '-moz-transform',
            'transform': 'transform'
        };
        document.body.insertBefore(element, null);
        for (var t in transforms) {
            if (!!element[t]) {
                el.style[t] = "translate3d(1px,1px,1px)";
                has3d = window.getComputedStyle(el).getPropertyValue(transforms[t]);
            }
        }
        document.body.removeChild(element);
        return !!has3d &amp;&amp; has3d.length > 0 &amp;&amp; has3d !== "none";
    }

    function isTouch() {
        return ('ontouchstart' in window) &amp;&amp; (window.navigator.MaxTouchPoints > 0);
    }

    function supportsInput(type) {
        try {
            var input = document.createElement('input');
            input.setAttribute("type", type);
        } catch (e) {
            return false;
        }
        return input.type !== "text";
    }

    function supportsFullscreen() {
        var documentEl = document.documentElement;
        return ((!!documentEl.requestFullscreen) || !!documentEl.mozRequestFullScreen || !!documentEl.webkitRequestFullScreen || !!documentEl.msRequestFullscreen);
    }

    function supportsWebSocket() {
        try {
            return 'WebSocket' in window &amp;&amp; window.WebSocket.CLOSING === 2;
        } catch (e) {
            return false;
        }
    }

    /** Variable initialization     */

    this.hasCanvas = supportsCanvas();
    this.hasWebGL = supportsWebGL();
    this.hasFile = supportsInput("file");
    this.hasLocalStorage = supportsHTML5Storage();
    //this.hasCss3D = supportsCss3D();
    this.hasTypedArray = 'ArrayBuffer' in window;
    //  Input
    this.hasTouch = isTouch();
    //  Audio
    this.hasWebAudio = supportsWebAudio();
    // Device features
    this.webSocket = supportsWebSocket();
    this.fullscreen = supportsFullscreen();
    var range = supportsInput("range");
    this.hasGeneralInputTypes = range; // Can do hasFile too
    this.isCompatible = this.hasCanvas &amp;&amp; this.hasGeneralInputTypes
            &amp;&amp; this.webSocket &amp;&amp; this.hasWebAudio;
};

/**
 * sets up Callback after device is detected to be ready, triggers the rest of the initialization
 * @memberof Flare.Device
 * @function whenReady
 * @param {function} callback function to callback after ready
 * @param {object} context context of the callback
 */
Flare.Device.whenReady = function (callback, context) {

    var readyCheck = this._readyCheck;

    if (this.deviceReadyAt || !readyCheck) {

        //Device is already done loading
        callback.call(context, this);

    } else if (readyCheck._monitor) {

        readyCheck._queue = readyCheck._queue || [];
        readyCheck._queue.push([callback, context]);

    } else {

        readyCheck._monitor = readyCheck.bind(this);
        readyCheck._queue = readyCheck._queue || [];
        readyCheck._queue.push([callback, context]);


        if (document.readyState === 'complete' || document.readyState === 'interactive') {

            window.setTimeout(readyCheck._monitor, 0);

        } else {
            document.addEventListener('DOMContentLoaded', readyCheck._monitor, false);
            window.addEventListener('load', readyCheck._monitor, false);
        }
    }
};

/**
 * Keeps checkign to see if DOM is fully loaded and ready 
 * @memberof Flare.Device
 * @function _readyCheck
 */
Flare.Device._readyCheck = function () {

    var readyCheck = this._readyCheck;

    if (!document.body) {

        window.setTimeout(readyCheck._monitor, 20);

    } else if (!this.deviceReadyAt) {

        this.deviceReadyAt = Date.now();

        document.removeEventListener('deviceready', readyCheck._monitor);
        document.removeEventListener('DOMContentLoaded', readyCheck._monitor);
        window.removeEventListener('load', readyCheck._monitor);

        this._initialize();
        this.initialized = true;


        var item;
        while ((item = readyCheck._queue.shift())) {
            var callback = item[0];
            var context = item[1];
            callback.call(context, this);
        }

        this._readyCheck = null;
        this._initialize = null;
        this.onInitialized = null;
    }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Flare.AudioEngine.html">AudioEngine</a></li><li><a href="Flare.Buffer.html">Buffer</a></li><li><a href="Flare.Canvas.html">Canvas</a></li><li><a href="Flare.Clock.html">Clock</a></li><li><a href="Flare.Device.html">Device</a></li><li><a href="Flare.FlareMessage.html">FlareMessage</a></li><li><a href="Flare.InitializeVideoTask.html">InitializeVideoTask</a></li><li><a href="Flare.MediaPlayer.html">MediaPlayer</a></li><li><a href="Flare.NetworkManager.html">NetworkManager</a></li><li><a href="Flare.OpenVideoMessage.html">OpenVideoMessage</a></li><li><a href="Flare.Oscillator.html">Oscillator</a></li><li><a href="Flare.ProcessAudioTask.html">ProcessAudioTask</a></li><li><a href="Flare.ProcessFrameTask.html">ProcessFrameTask</a></li><li><a href="Flare.VideoPlayer.html">VideoPlayer</a></li></ul><h3>Namespaces</h3><ul><li><a href="Flare.html">Flare</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu May 19 2016 03:20:08 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
