/*! FlareMediaPlayer Version:0.0.0 Built On: 2016-05-07 */
(function(){var a=this,b=b||{VERSION:"0.0.0",PLAYERS:[]};return b.CONSTANTS={VIDEO_SIZE:{ORIGINAL:0,FIXED:1,RESPONSIVE:2},VIDEO_SCALE_MODE:{MAINTAIN_ASPECT:0,FILL:1},FLARE_MESSAGE_HEADER_LENGTH:5},b.InitializeVideoTask=function(){return this.data,this.dataView,this.flareOpCode,this.mediaPlayer,this},b.InitializeVideoTask.prototype.setData=function(a){this.data=a,this.dataView=new DataView(this.data),this.flareOpCode=b.OpCode.OPEN_VIDEO,this.videoIsAvailable=!1,this.width=0,this.height=0,this.fps=0,this.duration=0},b.InitializeVideoTask.prototype.setMediaPlayer=function(a){this.mediaPlayer=a},b.InitializeVideoTask.prototype.process=function(){var a=(this.dataView.getInt32(1),this.dataView.getInt8(5));console.log("the video you requested is "+this.mediaPlayer.options.videoID),1===a?(this.videoIsAvailable=!0,this.width=this.dataView.getInt32(6),this.height=this.dataView.getInt32(10),this.fps=this.dataView.getFloat64(14),this.duration=this.dataView.getFloat64(22),console.log(this.width+" width"),console.log(this.height+" height "),console.log(this.fps+" fps "),console.log(this.duration+" duration "),this.mediaPlayer.buffer.initFrameBuffer(337,this.fps),console.log("video is available!")):console.log("video is not available!")},b.InitializeVideoTask.prototype.constructor=b.InitializeVideoTask,b.ProcessAudioTask=function(){return this.data,this.dataView,this.flareOpCode,this.mediaPlayer,this},b.ProcessAudioTask.prototype.setData=function(a){this.data=a,this.dataView=new DataView(this.data),this.flareOpCode=b.OpCode.FRAME,this.videoIsAvailable=!1},b.ProcessAudioTask.prototype.setMediaPlayer=function(a){this.mediaPlayer=a},b.ProcessAudioTask.prototype.process=function(){this.dataView.getInt32(0);this.mediaPlayer.buffer.setAudioData(this.data.slice(5)),this.mediaPlayer.audioEngine.init()},b.ProcessAudioTask.prototype.constructor=b.ProcessAudioTask,b.ProcessFrameTask=function(){return this.data,this.dataView,this.flareOpCode,this.mediaPlayer,this},b.ProcessFrameTask.prototype.setData=function(a){this.data=a,this.dataView=new DataView(this.data),this.flareOpCode=b.OpCode.FRAME,this.videoIsAvailable=!1},b.ProcessFrameTask.prototype.setMediaPlayer=function(a){this.mediaPlayer=a},b.ProcessFrameTask.prototype.process=function(){var a=(this.dataView.getInt32(0),this.dataView.getUint32(5)),b=new Image,c=new Blob([this.data.slice(9)],{type:"image/jpg"}),d=window.URL||window.webkitURL,e=d.createObjectURL(c);b.src=e,console.log("frame "+a+"loaded"),this.mediaPlayer.buffer.setFrameAt(a,b)},b.ProcessFrameTask.prototype.constructor=b.ProcessFrameTask,b.AudioEngine=function(a){return this.mediaPlayer=a,this.mute,this.source=null,this.analyser,this.distortion,this.gainNode,this.biquadFilter,this.soundSource,this},b.AudioEngine.prototype={boot:function(){this.gainNode=this.mediaPlayer.audioCtx.createGain(),this.playing=!1},createNewBufferSource:function(){this.source=this.mediaPlayer.audioCtx.createBufferSource(),this.mediaPlayer.audioCtx.decodeAudioData(this.mediaPlayer.buffer.getAudioSource(),function(a){this.source.buffer=a,console.log("done loading buffer"),this.source.connect(this.gainNode),this.gainNode.connect(this.mediaPlayer.audioCtx.destination)}.bind(this))},connectBuffer:function(a){this.source.buffer=a,console.log("done loading buffer"),this.source.connect(this.gainNode),this.gainNode.connect(this.mediaPlayer.audioCtx.destination)},playSound:function(a){this.createNewBufferSource(),this.source.start||(this.source.start=source.noteOn),this.source.start(a),this.playing=!0},stopSound:function(a){this.source.stop||(this.source.stop=this.source.noteOff),this.source.stop(a),this.playing=!1},toggle:function(a){this.playing?this.stop(a):this.play(a),this.playing=!this.playing},muteAudio:function(){"activated"!=this.mute.id?(this.gainNode.gainvalue=0,this.mute.id="activated",this.mute.innerHTML="Unmute"):(this.gainNode.gain.value=1,this.mute.id="deactivated",this.mute.innerHTML="Mute")},changeVolume:function(a){var b=element.value,c=parseInt(b)/parseInt(element.max);this.gainNode.gain.value=c*c}},b.AudioEngine.prototype.constructor=b.AudioEngine,b.AudioPlayer=function(a){return this.mediaPlayer=a,this},b.AudioPlayer.prototype={},b.AudioPlayer.prototype.constructor=b.AudioPlayer,b.Buffer=function(a){return this.mediaPlayer=a,this.testFrame=null,this.channels=2,this.frame_count=this.mediaPlayer.audioCtx.sampleRate=2,this.audio_buffer=this.mediaPlayer.audioCtx.createBuffer(this.channels,this.frame_count,this.mediaPlayer.audioCtx.sampleRate),this.frameBuffer,this.frameCount,this.frameRate,this.framesLoaded=0,this.isLoaded=!1,this.audioData=null,this},b.Buffer.prototype={write:function(){for(var a=0;a<channels;a++){this.current_buffer=this.audio_buffer.getChannelData(a);for(var b=0;b<this.frame_count;b++)this.current_buffer[b]=2*Math.random()-1}var c=this.mediaPlayer.audioSource;c.buffer=this.audio_buffer,c.connect(this.mediaPlayer.audioCtx.destination)},read:function(){return this.return_array=this.audio_buffer.slice(),this.return_array},initFrameBuffer:function(a,b){this.frameBuffer=new Array(a),this.frameCount=a,this.frameRate=b},getFrameAt:function(a){return this.frameBuffer[a]},setFrameAt:function(a,b){this.frameBuffer[a]=b,this.framesLoaded++,this.frameCount==this.framesLoaded&&(this.isLoaded=!0,this.mediaPlayer.videoPlayer.toggleLockingButtons(),this.mediaPlayer.videoPlayer.removeLoadingBar(),console.log("buffer doneLoading"))},setAudioData:function(a){this.audioData=a,console.log(this.audioData)},getAudioSource:function(){return this.audioData}},b.Buffer.prototype.constructor=b.Buffer,b.Canvas=function(a){return this.videoPlayer=a,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.id="testId",this.canvas.width=960,this.canvas.height=540,this.canvas.style.display="block",this.canvas.style.backgroundColor="black",this},b.Canvas.prototype={render:function(a){this.ctx.drawImage(a,0,0)},getCanvas:function(){return this.canvas}},b.Canvas.prototype.constructor=b.Canvas,b.MediaPlayer=function(a){return this.id=b.PLAYERS.push(this)-1,this.options={videoID:"",container:"",videoSize:b.CONSTANTS.VIDEO_SIZE.ORIGINAL,videoScale:"",width:960,height:540},this.parseOptions(a),this.parent="parent",this.url=null,this.frameWidth=null,this.frameHeight=null,this._networkManager=null,this._forceUpdate,this.isBooted=null,this.oscillator=null,this.videoPlayer=null,this.audioEngine=null,this.buffer=null,this.audioCtx=null,this.isPlaying=!1,this.testCounter=0,this.timeStarted=0,this.totalTimePaused=0,this.numPressedPlay=0,this.device=b.Device,this.device.whenReady(this.boot,this),console.log("Flare Media Player BETA  www.flaremediaplayer.com"),this},b.MediaPlayer.prototype={parseOptions:function(a){console.log(a),"undefined"!=typeof a.videoID?this.options.videoID=a.videoID:console.log("location is not set")},boot:function(){if(!this.isBooted){this._forceUpdate=!0;var a=window.AudioContext||window.webkitAudioContext;this.audioCtx=new a,this.oscillator=new b.Oscillator(this),this.clock=new b.Clock(this),this.buffer=new b.Buffer(this),this.audioEngine=new b.AudioEngine(this),this._networkManager=new b.NetworkManager(this),this.videoPlayer=new b.VideoPlayer(this),this.videoPlayer.boot(),this.audioEngine.boot(),this.clock.boot(),this.oscillator.run()}},update:function(a){this.clock.update(a),0===this.numPressedPlay&&this.setStartTime(Date.now()),this.isPlaying&&(this.videoPlayer.updateTimeDisplay(this.clock.totalTimePlayed(this.timeStarted,this.totalTimePaused),"0:33"),this.videoPlayer.update(this.buffer.getFrameAt(this.testCounter),this.testCounter),this.testCounter=(this.testCounter+1)%151)},setStartTime:function(a){this.timeStarted=a},togglePlay:function(){this.isPlaying?(this.isPlaying=!1,this.clock.setPauseTime(Date.now())):(this.isPlaying=!0,this.audioEngine.playSound(0),this.numPressedPlay>0&&(this.totalTimePaused+=Date.now()-this.clock.getPauseTime()),this.numPressedPlay++)},isPlayMode:function(){return this.isPlaying},getNumPressedPlay:function(){return this.numPressedPlay}},b.MediaPlayer.prototype.constructor=b.MediaPlayer,b.VideoEngine=function(a){return this.mediaPlayer=a,this.canvas=null,this.videoWidth,this.videoHeight,this.videoPlayer=null,this},b.VideoEngine.prototype={boot:function(){var a,b=this.mediaPlayer.parent;b&&("string"==typeof b?a=document.getElementById(b):"object"==typeof b&&1===b.nodeType&&(a=b)),a||(a=document.body),a.appendChild(this.videoPlayer)},initialize:function(){this.videoPlayer=document.createElement("div"),this.videoPlayer.id="videoId",this.canvas=new b.Canvas}},b.VideoEngine.prototype.constructor=b.VideoEngine,b.VideoPlayer=function(a){return this.mediaPlayer=a,this.canvas=null,this.videoWidth,this.videoHeight,this.videoPlayer,this.controlBar,this.progressBarContainer,this.playButton,this.controlBarInner,this.leftControls,this.rightControls,this.settingsButton,this.settingsPath,this.progressBar,this.progressBarDisplayGroup,this.playProgress,this.timeDisplay,this.volumeControl,this.muteButton,this.loadingBar,this.buttonsLocked=!1,this.muteButtonStyle={background:"none",border:"none",color:"white"},this.volumeControlStyle={display:"inline-block"},this.timeDisplayStyle={display:"inline-block",padding:"0 5px","line-height":"30px",color:"rgba(255,255,255,0.95)","font-family":"Verdana, Geneva, sans-serif","font-size":"12px"},this.playProgressStyle={position:"absolute",bottom:0,left:"0px","background-color":"rgba(0,0,255,0.7)",height:"100%",width:"100%","transform-origin":"0 0 "},this.progressBarDisplayGroupStyle={height:"100%",transition:"transform .1s cubic-bezier(0.4,0.0,1,1)","background-color":"rgba(255,255,255,0.6)","transform-origin":"bottom"},this.progressBarStyle={position:"absolute",bottom:0,left:0,width:"100%",height:"100%","touch-action":"none"},this.progressBarAttribtues={role:"slider",draggable:"true","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},this.rightControlsStyle={"float":"right",height:"100%"},this.leftControlsStyle={"float":"left",height:"100%"},this.videoPlayerStyle={position:"relative",overflow:"hidden",width:"960px",height:"540px"},this.controlBarInnerStyle={},this.controlBarStyle={height:"30px",position:"absolute",bottom:"0",left:0,right:0,"background-color":"rgba(0,0,0,0.5)"},this.playButtonStyle={color:"white","font-size":"20px",background:"transparent",border:"none",cursor:"pointer",width:"30px"},this.progressBarContainerStyle={width:"100%",position:"absolute",height:"5px",bottom:"30px",cursor:"pointer"},this.loadingBarStyle={position:"absolute",left:"40%",top:"30%",right:"0px",bottom:"0px",width:"100%",height:"100%","z-index":"99",background:"url('../src/images/page-loader.gif')","background-repeat":"no-repeat"},this},b.VideoPlayer.prototype={boot:function(){this.videoPlayer=document.createElement("div"),this.loadingBar=document.createElement("div"),this.controlBar=document.createElement("div"),this.progressBarContainer=document.createElement("div"),this.leftControls=document.createElement("div"),this.rightControls=document.createElement("div"),this.controlBarInner=document.createElement("div"),this.playButton=document.createElement("button"),this.muteButton=document.createElement("button"),this.volumeControl=document.createElement("div"),this.progressBar=document.createElement("div"),this.progressBarDisplayGroup=document.createElement("div"),this.controlBarInner=document.createElement("div"),this.playProgress=document.createElement("div"),this.timeDisplay=document.createElement("div"),this.settingsButton=document.createElement("svg"),this.settingsPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.settingsPath.setAttributeNS(null,"d",b.Icons.settings),this.videoPlayer.id="videoId",this.playButton.innerHTML="&#x025B8;",this.muteButton.innerHTML="&#9732;",this.canvas=new b.Canvas(this),this.setStyle(this.videoPlayer,this.videoPlayerStyle),this.setStyle(this.controlBar,this.controlBarStyle),this.setStyle(this.playButton,this.playButtonStyle),this.setStyle(this.progressBarContainer,this.progressBarContainerStyle),this.setStyle(this.leftControls,this.leftControlsStyle),this.setStyle(this.rightControls,this.rightControlsStyle),this.setStyle(this.progressBar,this.progressBarStyle),this.setStyle(this.progressBarDisplayGroup,this.progressBarDisplayGroupStyle),this.setStyle(this.playProgress,this.playProgressStyle),this.setStyle(this.timeDisplay,this.timeDisplayStyle),this.setStyle(this.volumeControl,this.volumeControlStyle),this.setStyle(this.muteButton,this.muteButtonStyle),this.setStyle(this.loadingBar,this.loadingBarStyle),this.setAttributes(this.progressBar,this.progressBarAttribtues),this.settingsButton.appendChild(this.settingsPath),this.videoPlayer.appendChild(this.canvas.getCanvas()),this.controlBarInner.appendChild(this.leftControls),this.controlBarInner.appendChild(this.rightControls),this.volumeControl.appendChild(this.muteButton),this.leftControls.appendChild(this.playButton),this.leftControls.appendChild(this.volumeControl),this.leftControls.appendChild(this.timeDisplay),this.rightControls.appendChild(this.settingsButton),this.progressBarContainer.appendChild(this.progressBar),this.progressBar.appendChild(this.progressBarDisplayGroup),this.progressBarDisplayGroup.appendChild(this.playProgress),this.controlBar.appendChild(this.progressBarContainer),this.controlBar.appendChild(this.controlBarInner),this.progressBar.onmousedown=this.handleMouseDown.bind(this),this.progressBar.ondragstart=this.handleDragStart.bind(this),this.progressBar.ondrag=this.handleDrag.bind(this),this.progressBar.ondragend=this.handleDragEnd.bind(this),this.playButton.onclick=this.handlePlayButtonPress.bind(this),this.videoPlayer.appendChild(this.controlBar),this.videoPlayer.appendChild(this.loadingBar),this.mediaPlayer.buffer.isLoaded||this.toggleLockingButtons(),this.updatePlayProgress(.4);var a,c=null;c&&("string"==typeof c?a=document.getElementById(c):"object"==typeof c&&1===c.nodeType&&(a=c)),a||(a=document.body),a.appendChild(this.videoPlayer)},update:function(a,b){this.canvas.render(a),this.updatePlayProgress(b/150)},setStyle:function(a,b){for(var c in b)a.style.setProperty(c,b[c])},setAttributes:function(a,b){for(var c in b)a.setAttribute(c,b[c])},updatePlayProgress:function(a){this.playProgress.style.setProperty("transform","scaleX("+a+")"),this.progressBar.setAttribute("aria-valuenow",parseInt(100*a))},handleMouseDown:function(a){console.log(a);parseInt(this.progressBar.getAttribute("aria-valuenow"));return this.mediaPlayer.isPlaying=!1,!1},handleDragStart:function(a){console.log(a)},handleDrag:function(a){console.log(a)},handleDragEnd:function(a){},handlePlayButtonPress:function(a){console.log("play clicked"),this.mediaPlayer.togglePlay(),this.mediaPlayer.isPlayMode()?this.playButton.innerHTML="||":this.playButton.innerHTML="&#x025B8;"},updateTimeDisplay:function(a,b){this.timeDisplay.innerHTML=a+" / "+b},removeLoadingBar:function(){this.videoPlayer.removeChild(this.loadingBar)},toggleLockingButtons:function(){this.buttonsLocked?(this.playButton.removeAttribute("disabled"),this.muteButton.removeAttribute("disabled"),this.volumeControl.removeAttribute("disabled"),this.progressBar.removeAttribute("disabled"),this.settingsButton.removeAttribute("disabled"),this.buttonsLocked=!1):(this.playButton.setAttribute("disabled","disabled"),this.muteButton.setAttribute("disabled","disabled"),this.volumeControl.setAttribute("disabled","disabled"),this.progressBar.setAttribute("disabled","disabled"),this.settingsButton.setAttribute("disabled","disabled"),this.buttonsLocked=!0)}},b.VideoPlayer.prototype.constructor=b.VideoPlayer,b.FlareMessage=function(){return this.flareOpCode,this.totalMessageLength,this.dataLength,this.headerLength=5,this},b.FlareMessage.prototype={addStringToBinary:function(a,b,c){a.setUint8(b,255&c.length);for(var d=0;d<c.length;d++)a.setUint8(d+1+b,c.charCodeAt(d))}},b.Buffer.prototype.constructor=b.FlareMessage,b.OpenVideoMessage=function(){return b.FlareMessage.call(this),this.flareOpCode=b.OpCode.OPEN_VIDEO,this.requestFile="",this},b.OpenVideoMessage.prototype=Object.create(b.FlareMessage.prototype),b.OpenVideoMessage.prototype.constructor=b.OpenVideoMessage,b.OpenVideoMessage.prototype.setRequestFile=function(a){this.requestFile=a},b.OpenVideoMessage.prototype.toBinary=function(){this.dataLength=this.requestFile.length+1,this.totalMessageLength=this.dataLength+this.headerLength;var a=new ArrayBuffer(this.totalMessageLength),b=new DataView(a);return b.setInt8(0,255&this.flareOpCode),b.setInt32(1,4294967295&this.totalMessageLength),this.addStringToBinary(b,this.headerLength,this.requestFile),a},b.OpCode={OPEN_VIDEO:0,FRAME:1,AUDIO:2},b.TaskTable={},b.TaskTable[b.OpCode.OPEN_VIDEO]=b.InitializeVideoTask,b.TaskTable[b.OpCode.FRAME]=b.ProcessFrameTask,b.TaskTable[b.OpCode.AUDIO]=b.ProcessAudioTask,b.Icons={settings:"M863.24,382.771l-88.759-14.807c-6.451-26.374-15.857-51.585-28.107-75.099l56.821-70.452   c12.085-14.889,11.536-36.312-1.205-50.682l-35.301-39.729c-12.796-14.355-34.016-17.391-50.202-7.165l-75.906,47.716   c-33.386-23.326-71.204-40.551-112-50.546l-14.85-89.235c-3.116-18.895-19.467-32.759-38.661-32.759h-53.198   c-19.155,0-35.561,13.864-38.608,32.759l-14.931,89.263c-33.729,8.258-65.353,21.588-94.213,39.144l-72.188-51.518   c-15.558-11.115-36.927-9.377-50.504,4.171l-37.583,37.61c-13.548,13.577-15.286,34.946-4.142,50.504l51.638,72.326   c-17.391,28.642-30.584,60.086-38.841,93.515l-89.743,14.985C13.891,385.888,0,402.24,0,421.435v53.156   c0,19.193,13.891,35.547,32.757,38.663l89.743,14.985c6.781,27.508,16.625,53.784,29.709,78.147L95.647,676.44   c-12.044,14.875-11.538,36.312,1.203,50.669l35.274,39.73c12.797,14.382,34.028,17.363,50.216,7.163l77-48.37   c32.581,22.285,69.44,38.664,108.993,48.37l14.931,89.25c3.048,18.896,19.453,32.76,38.608,32.76h53.198   c19.194,0,35.545-13.863,38.661-32.759l14.875-89.25c33.308-8.147,64.531-21.245,93.134-38.5l75.196,53.705   c15.53,11.155,36.915,9.405,50.478-4.186l37.598-37.597c13.532-13.536,15.365-34.893,4.127-50.479l-53.536-75.059   c17.441-28.738,30.704-60.238,38.909-93.816l88.758-14.82c18.921-3.116,32.756-19.469,32.756-38.663v-53.156   C895.998,402.24,882.163,385.888,863.24,382.771z M449.42,616.013c-92.764,0-168-75.25-168-168c0-92.764,75.236-168,168-168   c92.748,0,167.998,75.236,167.998,168C617.418,540.763,542.168,616.013,449.42,616.013z"},b.NetworkManager=function(a){return this.mediaPlayer=a,this.socket,this.connected=!1,this.callbacks={},this.connect(),this.setup(),this},b.NetworkManager.prototype={connect:function(){this.socket=new WebSocket("ws://localhost:6661"),this.socket.binaryType="arraybuffer"},close:function(){this.socket.close()},setup:function(){this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this)},onOpen:function(){this.connected=!0,console.log("connection Opened"),this.requestVideo()},onClose:function(a){console.log("closed"),console.log(a)},onMessage:function(a){if(a.data instanceof ArrayBuffer){var c=new DataView(a.data),d=c.getInt8(4);c.getUint32(0);console.log("opCode "+d);var e=new b.TaskTable[d];e.setData(a.data),e.setMediaPlayer(this.mediaPlayer),e.process()}else if("string"==typeof a.data){var f=JSON.parse(a.data);console.log(f.test)}},onError:function(a){console.log(a)},send:function(a){this.socket.send(a)},getEndianness:function(){var a=new ArrayBuffer(4),b=new Uint8Array(a),c=new Uint32Array(a);if(b[0]=161,b[1]=178,b[2]=195,b[3]=212,3569595041===c[0])return BlobReader.ENDIANNESS.LITTLE_ENDIAN;if(2712847316===c[0])return BlobReader.ENDIANNESS.BIG_ENDIAN;throw new Error("Unrecognized endianness")},requestVideo:function(){var a=new b.OpenVideoMessage;a.setRequestFile(this.mediaPlayer.options.videoID),this.socket.send(a.toBinary())}},b.NetworkManager.prototype.constructor=b.NetworkManager,b.NETWORK_PROTOCOL_TABLE={},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Flare=b):"undefined"!=typeof define&&define.amd?define("Flare",function(){return a.Flare=b}()):a.Flare=b,b}).call(this),Flare.Clock=function(a){return this.mediaPlayer=a,this._timeInitialized=0,this.elapsed=0,this.elapsedMs=0,this.previousTime=0,this.currentTime=0,this.timeUpdated=0,this.lastTimeUpdated=0,this.timeStarted=0,this.timePaused=0,this.time=0,this.minutes=0,this},Flare.Clock.prototype={boot:function(){this._timeInitialized=Date.now(),this.timeUpdated=Date.now()},refresh:function(){this.lastTimeUpdated=this.timeUpdated,this.timeUpdated=Date.now(),this.elapsedMs=this.timeUpdated-this.lastTimeUpdated},update:function(a){this.lastTimeUpdated=this.timeUpdated,this.timeUpdated=Date.now(),this.elapsedMS=this.timeUpdated-this.lastTimeUpdated,this.previousTime=this.currentTime,this.currentTime=a,this.elapsed=this.currentTime-this.previousTime},totalTimePlayed:function(a,b){if(0===a)return 0;this.time=(Date.now()-a-b)/1e3;var c=Math.floor(1*this.time)/1;return c>59&&(console.log(c),this.minutes++,this.time=0,c=0,this.mediaPlayer.setStartTime(Date.now())),10>c?this.minutes+":0"+c:this.minutes+":"+c},getPauseTime:function(){return this.timePaused},setPauseTime:function(a){this.timePaused=a}},Flare.Clock.prototype.constructor=Flare.Clock,Flare.Oscillator=function(a){return this.mediaPlayer=a,this.running=!1,this._loopFunction=null,this._eventId=null,this.fps=30,this.updateSpeed=0,this.usingSetTimeOut=!1,this.usingRequestAnimationFrame=!1,this},Flare.Oscillator.prototype={run:function(){this.running=!0;var a=this;this.updateSpeed=Math.floor(1e3/this.fps),window.requestAnimationFrame?(this.usingRequestAnimationFrame=!0,this._loopFunction=function(b){return a.updateRequestAnimationFrame(b)},this._eventId=window.requestAnimationFrame(this._loopFunction)):(this.usingSetTimeOut=!0,this._loopFunction=function(){return a.updateSetTimeout()},this._eventId=window.setTimeout(this._loopFunction,0))},stop:function(){this.usingSetTimeOut?clearTimeout(this._eventId):window.cancelAnimationFrame(this._eventId),this.running=!1},updateRequestAnimationFrame:function(a){this.mediaPlayer.update(Math.floor(a)),this._eventId=window.requestAnimationFrame(this._loopFunction)},updateSetTimeout:function(){this.mediaPlayer.update(Date.now()),this._eventId=window.setTimeout(this._loopFunction,this.updateSpeed)}},Flare.Oscillator.prototype.constructor=Flare.Oscillator,Flare.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.isCompatible=!1,this.hasGeneralInputTypes=!1,this.hasCanvas=!1,this.hasWebGL=!1,this.hasFile=!1,this.hasLocalStorage=!1,this.hasTypedArray=!1,this.hasTouch=!1,this.hasWebAudio=!1,this.fullscreen=!1,this.webSocket=!1},Flare.Device=new Flare.Device,Flare.Device._initialize=function(){function a(){var a=document.createElement("canvas");return!!a.getContext}function b(){var a="webkitAudioContext"in window,b="AudioContext"in window;if(!a&&!b){var c=document.createElement("audio");return c.canPlayType}return!0}function c(){try{var a=document.createElement("canvas"),b=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(c){return!1}return!!b}function d(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function e(){return"ontouchstart"in window&&window.navigator.MaxTouchPoints>0}function f(a){try{var b=document.createElement("input");b.setAttribute("type",a)}catch(c){return!1}return"text"!==b.type}function g(){var a=document.documentElement;return!!(a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen||a.msRequestFullscreen)}function h(){try{return"WebSocket"in window&&2===window.WebSocket.CLOSING}catch(a){return!1}}this.hasCanvas=a(),this.hasWebGL=c(),this.hasFile=f("file"),this.hasLocalStorage=d(),this.hasTypedArray="ArrayBuffer"in window,this.hasTouch=e(),this.hasWebAudio=b(),this.webSocket=h(),this.fullscreen=g();var i=f("range");this.hasGeneralInputTypes=i,this.isCompatible=this.hasCanvas&&this.hasGeneralInputTypes&&this.webSocket&&this.hasWebAudio},Flare.Device.whenReady=function(a,b){var c=this._readyCheck;this.deviceReadyAt||!c?a.call(b,this):c._monitor?(c._queue=c._queue||[],c._queue.push([a,b])):(c._monitor=c.bind(this),c._queue=c._queue||[],c._queue.push([a,b]),"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(c._monitor,0):(document.addEventListener("DOMContentLoaded",c._monitor,!1),window.addEventListener("load",c._monitor,!1)))},Flare.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0;for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},Flare.EventDispatcher=function(){},Flare.EventDispatcher.prototype={},Flare.EventDispatcher.prototype.constructor=Flare.EventDispatcher;